@model List<UserAccountDataModel>

@{
    ViewData["Title"] = "Панель администратора - Список пользователей";
}

<h1 class="display-4">Панель администратора - Список пользователей</h1>

<p>
    <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#userSearch" aria-expanded="false" aria-controls="userSearch">
        Поиск пользователей
    </button><br />
    <div class="collapse" id="userSearch">
        <div class="card card-body">
            <form method="post">
                <p>
                    <label>Идентификатор пользователя</label>
                    @Html.TextBox("userId", "", new Dictionary<string, object>() { { "class", "form-control" } })
                </p>
                <p>
                    <table>
                        <tr>
                            <td>
                                <label>Фамилия</label>
                                @Html.TextBox("userLastName", "", new Dictionary<string, object>() { { "class", "form-control" } })
                            </td>
                            <td>
                                <label>Имя</label>
                                @Html.TextBox("userFirstName", "", new Dictionary<string, object>() { { "class", "form-control" } })
                            </td>
                            <td>
                                <label>Отчество</label>
                                @Html.TextBox("userMiddleName", "", new Dictionary<string, object>() { { "class", "form-control" } })
                            </td>
                        </tr>
                    </table>
                </p>
                <p>
                    <label>Электронная почта</label>
                    @Html.TextBox("userEmail", "", new Dictionary<string, object>() { { "class", "form-control" } })
                </p>
                <p>
                    @Html.CheckBox("userIsAdmin", false, new Dictionary<string, string> { { "class", "form-check-input" } })
                    <label class="form-check-label" for="userIsAdmin">Только администраторы</label>
                </p>
                <p><button class="btn btn-primary">Совершить поиск</button></p>
            </form>
        </div>
    </div>
</p>
@if (Model.Count > 0)
{
    int currentUserId = int.Parse(User?.FindFirst("UserId")?.Value ?? "0");

    <table class="table table-striped">
        <tr>
            <th>Идентификатор</th>
            <th>Полное имя</th>
            <th>Адрес электронной почты</th>
            <th>Количество вариантов расчёта</th>
            <th>Администратор</th>
            <th>Действия</th>
        </tr>
        @foreach (UserAccountDataModel user in Model)
        {
            <tr>
                <td>@user.Id</td>
                <td>@user.GetFullName()</td>
                <td>@user.Email</td>
                <td>@user.Variants.Count</td>
                <td>@(user.IsAdmin ? "Да" : "Нет")</td>
                <td>
                    <a href="/home/index?UserId=@user.Id">Список вариантов</a>
                    <a href="/home/userSettings?userId=@user.Id">Изменить данные</a>
                    @if (!user.IsAdmin)
                    {
                        <a href="/admin/userAdminConfirmation?userId=@user.Id">Назначить администратором</a>
                    }
                    else if (user.Id != currentUserId)
                    {
                        <a href="/admin/setUserAdmin?userId=@user.Id&admin=false">Убрать роль администратора</a>
                    }
                    <a href="/admin/userDeleteConfirmation?userId=@user.Id">Удалить</a>
                </td>
            </tr>
        }
    </table>
}
else
{
    <p>Пользователи, удовлетворяющие указанным условиям, не найдены.</p>
}